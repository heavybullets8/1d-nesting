<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nesting Software - Optimize Your Cuts</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/styles.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="/static/app.js"></script>
</head>
<body>
    <header>
        <h1>
            <img src="/static/favicon.png" alt="Logo" style="height: 1.5em; vertical-align: middle; width: auto;">
            Nesting Software
        </h1>
        <p class="tagline">Optimize your material cuts with advanced algorithms</p>
    </header>

    <div class="container" x-data="nestingApp">
        <div class="main-grid">
            <!-- Project Settings Card -->
            <div class="card">
                <h2>
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 6V5a3 3 0 013-3h2a3 3 0 013 3v1h2a2 2 0 012 2v3.57A22.952 22.952 0 0110 13a22.95 22.95 0 01-8-1.43V8a2 2 0 012-2h2zm2-1a1 1 0 011-1h2a1 1 0 011 1v1H8V5zm1 5a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"/>
                    </svg>
                    Project Settings
                </h2>

                <div class="form-group">
                    <label for="jobName">Job Name</label>
                    <input type="text" id="jobName" x-model="jobName" placeholder="My Project">
                </div>

                <div class="form-group">
                    <label for="materialType">Material Type</label>
                    <input type="text" id="materialType" x-model="materialType" placeholder="e.g., Wood, Steel Bar, Fabric Roll">
                    <p class="help-text">Describe your material (e.g., 2x4 wood, 1/2" steel bar)</p>
                </div>

                <div class="form-group">
                    <label for="stockLength">Stock Length</label>
                    <input type="text" id="stockLength" x-model="stockLength" placeholder="e.g., 24' or 288">
                    <div class="input-preview" x-show="stockPreview.show" :class="{ 'error': !stockPreview.valid }">
                        <strong>Interpreted as:</strong> <span x-text="stockPreview.text"></span>
                    </div>
                    <p class="help-text">Enter as feet (24'), inches (288), or feet+inches (20' 6")</p>
                </div>

                <div class="form-group">
                    <label for="kerf">Kerf Width (Blade/Cut Thickness)</label>
                    <input type="text" id="kerf" x-model="kerf" placeholder="e.g., 1/8 or 0.125">
                    <div class="input-preview" x-show="kerfPreview.show" :class="{ 'error': !kerfPreview.valid }">
                        <strong>Interpreted as:</strong> <span x-text="kerfPreview.text"></span>
                    </div>
                    <p class="help-text">Thickness of your cutting blade or material removal</p>
                </div>
            </div>

            <!-- Cut List Card -->
            <div class="card">
                <h2>
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    Cut List
                </h2>

                <div class="cuts-container">
                    <template x-if="!hasCuts">
                        <p style="text-align: center; color: #999;">No cuts added yet</p>
                    </template>

                    <template x-for="(cut, index) in cuts" :key="index">
                        <div class="cut-item">
                            <span class="cut-length" x-text="cut.length"></span>
                            <span class="cut-quantity" x-text="cut.quantity + '√ó'"></span>
                            <button class="remove-cut" @click="removeCut(index)">Remove</button>
                        </div>
                    </template>
                </div>

                <div class="add-cut-form">
                    <input type="text" x-model="cutLength" @keypress="handleCutKeypress" placeholder="Length (e.g., 7'6)">
                    <input type="number" x-model.number="cutQuantity" @keypress="handleCutKeypress" placeholder="Qty" min="1">
                    <button class="btn btn-success" @click="addCut">+ Add</button>
                </div>

                <div class="input-preview" x-show="cutPreview.show" :class="{ 'error': !cutPreview.valid }">
                    <strong>Will be added as:</strong> <span x-text="cutPreview.text"></span>
                </div>

                <div style="margin-top: 10px; display: flex; align-items: center; justify-content: flex-end;">
                    <span style="font-size: 0.9em; color: var(--gray);">Input Examples</span>
                    <span class="help-icon" @click="showModal = true">?</span>
                </div>

                <button class="btn btn-primary btn-full" @click="optimize">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    Optimize Cuts
                </button>
            </div>
        </div>

        <!-- Error Message -->
        <div class="error" x-show="errorMsg" x-text="errorMsg"></div>

        <!-- Loading Spinner -->
        <div class="loading" x-show="loading">
            <div class="spinner"></div>
            <p>Optimizing your cuts...</p>
        </div>

        <!-- Results -->
        <div class="results" x-show="results" x-ref="results">
            <template x-if="results">
                <div>
                    <div class="report-header">
                        <h1 x-text="results.jobName"></h1>
                        <p>
                            <strong>Material Type:</strong> <span x-text="results.materialType"></span><br>
                            <strong>Stock Length:</strong> <span x-text="results.stockLengthPretty"></span><br>
                            <strong>Kerf:</strong> <span x-text="results.kerfPretty"></span>"<br>
                            <strong>Date:</strong> <span x-text="formatDate(Date.now())"></span>
                        </p>
                    </div>

                    <h2>Required Cuts</h2>
                    <div class="required-cuts-list">
                        <template x-for="cut in results.cutsSummary" :key="cut.length">
                            <div class="required-cut-item">
                                <span class="required-cut-qty" x-text="cut.quantity + '√ó'"></span>
                                <div
                                    class="required-cut-bar"
                                    :class="getCutColorClass(cut.length)"
                                    :style="`width: ${(cut.length / results.stockLength) * 100}%`"
                                    x-text="cut.lengthPretty">
                                </div>
                            </div>
                        </template>
                    </div>

                    <h2>üìä Optimization Summary</h2>
                    <div class="summary-grid">
                        <div class="stat-card">
                            <div class="stat-value" x-text="results.solution.num_sticks"></div>
                            <div class="stat-label">Stock Pieces Needed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" x-text="results.solution.efficiency.toFixed(1) + '%'"></div>
                            <div class="stat-label">Efficiency</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" x-text="formatLength(results.solution.total_waste)"></div>
                            <div class="stat-label">Total Waste</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" x-text="results.optimizationTime.toFixed(2) + 's'"></div>
                            <div class="stat-label">Calc Time</div>
                        </div>
                    </div>

                    <h3>Cut Patterns</h3>
                    <template x-for="(pattern, i) in results.solution.patterns" :key="i">
                        <div style="margin-bottom: 20px;">
                            <p>
                                <strong x-text="pattern.count + '√ó Stock Pieces'"></strong>
                                (Waste: <span x-text="formatLength(pattern.waste_len)"></span>)
                            </p>
                            <div class="pattern-visual">
                                <template x-for="(cut, j) in pattern.cuts" :key="j">
                                    <div
                                        class="cut-segment"
                                        :class="getCutColorClass(cut.length)"
                                        :style="`width: ${(cut.length / results.stockLength) * 100}%`"
                                        :title="cut.pretty_length"
                                        x-text="cut.pretty_length">
                                    </div>
                                </template>
                                <template x-if="pattern.waste_len > 0.01">
                                    <div
                                        class="waste-segment"
                                        :style="`width: ${(pattern.waste_len / results.stockLength) * 100}%`"
                                        :title="'Waste: ' + formatLength(pattern.waste_len)">
                                        waste
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <button class="btn btn-accent" @click="printResults" style="margin-top: 20px;">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"/>
                        </svg>
                        Print Results
                    </button>
                </div>
            </template>
        </div>
    </div>

    <footer>
        <p>Powered by HiGHS optimization solver | Built with ‚ù§Ô∏è for makers</p>
    </footer>

    <!-- Examples Modal -->
    <div class="modal-overlay" x-show="showModal" @click.self="showModal = false" x-cloak style="display: none;" :style="showModal && 'display: flex'">
        <div class="modal-content">
            <button class="modal-close-btn" @click="showModal = false">&times;</button>
            <h4>üìê Input Examples</h4>
            <div class="example-table">
                <div class="example-row">
                    <span class="example-input">7' 6"</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">7' 6"</span>
                </div>
                <div class="example-row">
                    <span class="example-input">7' 6 1/2"</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">7' 6 1/2"</span>
                </div>
                <div class="example-row">
                    <span class="example-input">7' 6" 1/2</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">7' 6 1/2"</span>
                </div>
                <div class="example-row">
                    <span class="example-input">90 1/4</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">7' 6 1/4"</span>
                </div>
                <div class="example-row">
                    <span class="example-input">24'</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">24'</span>
                </div>
                <div class="example-row">
                    <span class="example-input">1/8</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">1/8"</span>
                </div>
                <div class="example-row">
                    <span class="example-input">0.125</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">1/8"</span>
                </div>
                <div class="example-row">
                    <span class="example-input">123.45</span>
                    <span class="example-arrow">‚Üí</span>
                    <span class="example-output">10' 3 1/2"</span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
